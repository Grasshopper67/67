<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>67 Clicker</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: url(https://media1.tenor.com/m/wXfbbjRyyWcAAAAd/scp-067-67.gif) center center / cover no-repeat fixed;
    display: flex;
    margin: 0;
    padding: 0;
    height: 100vh;
    overflow: hidden;
}
#leftPanel {
    flex: 1;
    background: #444;
    color: black;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
}
#game { flex: 2; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: transparent; }
#sidebar {
    flex: 1;
    background: #444;
    color: black;
    padding: 20px;
    overflow-y: auto;
    box-sizing: border-box;
}
#counter, #cps { font-size: 1.4em; color: #ddd; margin-bottom: 20px; text-align: center; }
#clicker { width: 150px; cursor: pointer; transition: transform 0.1s; }
#clicker:active { transform: scale(0.9); }
.upgrade {
    display: block;
    margin: 10px 0;
    padding: 10px;
    width: 100%;
    font-size: 1em;
    cursor: pointer;
    text-align: left;
    border: none;
    border-radius: 5px;
    background-color: #555;
    color: white;
    opacity: 0.5;
    transition: opacity 0.2s;
}
.upgrade.enabled { opacity: 1; }
.upgrade-description {
    display: block;
    font-size: 0.8em;
    color: #ddd;
    margin-top: 3px;
}
.floating67 {
    position: absolute;
    font-weight: bold;
    color: #ff0;
    animation: floatUp 1s forwards;
    font-size: 20px;
    pointer-events: none;
}
@keyframes floatUp {
    0% {opacity:1; transform:translateY(0);}
    100% {opacity:0; transform:translateY(-100px);}
}
#viewStatsBtn {
    margin-top: 20px;
    padding: 10px 15px;
    font-size: 1em;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: #666;
    color: white;
}
#statsOverlay {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.5);
    align-items:center; justify-content:center;
    z-index:999;
}
#statsPanel {
    background: #222;
    color: #fff;
    padding: 20px;
    border-radius: 10px;
    min-width: 300px;
    max-width: 90%;
    box-shadow: 0 0 10px #000;
    position: relative;
}
#statsPanel h3 { margin-top:0; }
#statsContent { margin-top:10px; font-size:0.95em; }
#closeStats { position:absolute; top:10px; right:15px; font-size:1.2em; cursor:pointer; }
</style>
</head>
<body>

<div id="leftPanel">
    <div id="counter">67s: 0</div>
    <img src="https://i.postimg.cc/PxsJHCyY/67-img.jpg" alt="67 Kid" id="clicker">
    <div id="cps">67s per second: 0</div>
    <button id="viewStatsBtn">View Stats</button>
</div>

<div id="game"></div>

<div id="sidebar">
    <h3>Upgrades</h3>
    <div id="upgradesContainer"></div>
</div>

<div id="statsOverlay">
    <div id="statsPanel">
        <span id="closeStats">&times;</span>
        <h3>Stats</h3>
        <div id="statsContent"></div>
    </div>
</div>

<audio id="bg-music" loop>
    <source src="67-funk.mp3" type="audio/mpeg">
</audio>

<script>
// ===== DATA (40 upgrades, balanced slower game) =====
const defaultUpgrades = [];
const upgradeNames = [
    "Auto 67","Double 67","Mega 67","Super 67","Ultra 67","Hyper 67","Legend 67","Titan 67",
    "Omega 67","Infinity 67","Eternal 67","Mythic 67","Quantum 67","Galactic 67","Celestial 67",
    "Cosmic 67","Supernova 67","Galaxy 67","Infinity Plus 67","Ultimate 67","Transcendent 67",
    "Ethereal 67","Spectral 67","Divine 67","Astral 67","Void 67","Chrono 67","Dimensional 67",
    "Parallel 67","Singularity 67","Beyond 67","Omniversal 67","Abyssal 67","Hypernova 67",
    "Nebula 67","Anomaly 67","Oblivion 67","Prime 67","Eclipse 67","Endless 67"
];

upgradeNames.forEach((name,i)=>{
    const isClick = i%2!==0;
    const baseCost = 150 * Math.pow(2.3,i);
    const perClick = isClick ? Math.floor(1 * Math.pow(1.9,i)) : 0;
    const perSecond = !isClick ? Math.floor(0.3 * Math.pow(1.8,i)) : 0;
    defaultUpgrades.push({name,type:isClick?"click":"auto",baseCost,perClick,perSecond,bought:0,unlocked:i===0});
});

let savedUpgrades = JSON.parse(localStorage.getItem('upgrades')) || [];
let upgrades = defaultUpgrades.map((u,i)=>({...u,...savedUpgrades[i]}));

let count = parseFloat(localStorage.getItem('count'))||0;
let perClick = parseFloat(localStorage.getItem('perClick'))||1;
let total67sPerSecond = parseFloat(localStorage.getItem('total67sPerSecond'))||0;

const counterEl = document.getElementById("counter");
const cpsEl = document.getElementById("cps");
const clicker = document.getElementById("clicker");
const upgradesContainer = document.getElementById("upgradesContainer");

// ===== RENDER UPGRADES =====
function renderUpgrades(){
    upgradesContainer.innerHTML = '';
    upgrades.forEach((u,i)=>{
        if(u.unlocked){
            const btn = document.createElement("button");
            btn.className = "upgrade";
            btn.dataset.index = i;
            const effect = u.type==="click"?`+${u.perClick} per click`:`+${u.perSecond} per second`;
            const cost = Math.floor(u.baseCost*Math.pow(1.7,u.bought));
            btn.innerHTML = `${u.name} - Cost: ${cost} <span class="upgrade-description">${effect}</span>`;
            btn.addEventListener("click",()=>buyUpgrade(i,btn));
            upgradesContainer.appendChild(btn);
        }
    });
    updateUpgradeButtons();
}

function updateUpgradeButtons(){
    const buttons = upgradesContainer.querySelectorAll("button");
    buttons.forEach(btn=>{
        const i = btn.dataset.index;
        const u = upgrades[i];
        const cost = Math.floor(u.baseCost*Math.pow(1.7,u.bought));
        btn.disabled = count < cost;
        btn.style.opacity = count >= cost ? 1 : 0.5;
        const effect = u.type==="click"?`+${u.perClick} per click`:`+${u.perSecond} per second`;
        btn.innerHTML = `${u.name} - Cost: ${cost} <span class="upgrade-description">${effect}</span>`;
    });
}

// ===== BUY UPGRADE (no delay) =====
function buyUpgrade(i){
    const u = upgrades[i];
    const cost = Math.floor(u.baseCost*Math.pow(1.7,u.bought));
    if(count >= cost){
        count -= cost;
        u.bought++;
        if(u.type==="click") perClick += u.perClick;
        if(u.type==="auto") total67sPerSecond += u.perSecond;
        updateDisplay();
        updateUpgradeButtons();
        saveGame(); // async save, no delay
    }
}

// ===== DISPLAY / CLICK / AUTO =====
function updateDisplay(){
    counterEl.textContent = `67s: ${Math.floor(count)}`;
    cpsEl.textContent = `67s per second: ${total67sPerSecond}`;
}
function showFloating67(amount){
    const span = document.createElement('span');
    span.className = 'floating67';
    span.textContent = `+${amount}`;
    const rect = clicker.getBoundingClientRect();
    span.style.left = rect.left+rect.width/2+'px';
    span.style.top = rect.top+'px';
    document.body.appendChild(span);
    setTimeout(()=>span.remove(),1000);
}
clicker.addEventListener('click',()=>{
    count += perClick;
    showFloating67(perClick);
    updateDisplay();
});
setInterval(()=>{
    count += total67sPerSecond/10;
    updateDisplay();
},100);
setInterval(()=>{
    upgrades.forEach(u=>{
        if(!u.unlocked && count >= u.baseCost/2) u.unlocked = true;
    });
    renderUpgrades();
},1000);

// ===== SAVE / LOAD / STATS =====
function saveGame(){
    requestIdleCallback(()=>{
        localStorage.setItem('count',count);
        localStorage.setItem('perClick',perClick);
        localStorage.setItem('total67sPerSecond',total67sPerSecond);
        localStorage.setItem('upgrades',JSON.stringify(upgrades));
    });
}
const viewStatsBtn=document.getElementById('viewStatsBtn');
const statsOverlay=document.getElementById('statsOverlay');
const statsContent=document.getElementById('statsContent');
const closeStats=document.getElementById('closeStats');
viewStatsBtn.addEventListener('click',()=>{
    updateStats();
    statsOverlay.style.display='flex';
});
closeStats.addEventListener('click',()=>statsOverlay.style.display='none');
statsOverlay.addEventListener('click',e=>{if(e.target===statsOverlay)statsOverlay.style.display='none';});
function updateStats(){
    const totalUpgradesBought=upgrades.reduce((sum,u)=>sum+u.bought,0);
    statsContent.innerHTML=`
        <strong>Total 67s:</strong> ${Math.floor(count)}<br>
        <strong>67s per click:</strong> ${perClick}<br>
        <strong>67s per second:</strong> ${total67sPerSecond}<br>
        <strong>Total upgrades bought:</strong> ${totalUpgradesBought}
    `;
}

// ===== MUSIC =====
const music=document.getElementById('bg-music');
music.volume=0.3;
document.addEventListener('click',()=>{if(music.paused) music.play().catch(()=>{});});
music.play().catch(()=>{console.log("Autoplay blocked.")});

renderUpgrades();
updateDisplay();
</script>
</body>
</html>
